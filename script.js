// ===== SYSTEME INTELLIGENT "LES BULLES DE JOIE" =====

class SmartSchoolSystem {
    constructor() {
        this.studentsData = {
            "aglo": {
                name: "AGLO Fifam√®",
                password: "fifam√®",
                notes: [19.25, 16.50, 5, 15, 15.25, 14, 15, 17, 12],
                comment: "Fifam√® montre une excellente compr√©hension en lecture et une belle progression en expression √©crite. Continuez √† encourager la pratique de la dict√©e √† la maison.",
                strengths: ["Lecture", "Expression √âcrite"],
                improvements: ["Dict√©e"],
                personality: "curieux"
            },
            "akyoh": {
                name: "AKYOH Emmanuel",
                password: "emmanuel",
                notes: [7.50, 18.50, 0, 12, 7, 14.50, 5.25, 18, 13],
                comment: "Emmanuel excelle en expression √©crite et en √©ducation sportive. Un effort particulier est n√©cessaire en dict√©e et en math√©matiques. N'h√©sitez pas √† revoir les bases avec lui.",
                strengths: ["Expression √âcrite", "√âducation Sportive"],
                improvements: ["Dict√©e", "Math√©matiques"],
                personality: "sportif"
            },
            "amadou": {
                name: "AMADOU Yinki",
                password: "yinki",
                notes: [15.5, 19, 5, 16.25, 7.75, 15, 13.25, 17, 14],
                comment: "Yinki a des talents certains en expression √©crite. Son travail en √©ducation scientifique pourrait √™tre renforc√© par des exercices pratiques √† la maison.",
                strengths: ["Expression √âcrite"],
                improvements: ["√âducation Scientifique"],
                personality: "creatif"
            },
            "bani": {
                name: "BANI Rahama",
                password: "rahama",
                notes: [13.75, 18.25, 12, 20, 17, 14.5, 7.25, 18, 15],
                comment: "Rahama brille particuli√®rement en √©ducation sociale o√π elle a obtenu la note maximale! Son engagement en math√©matiques m√©riterait d'√™tre soutenu.",
                strengths: ["√âducation Sociale"],
                improvements: ["Math√©matiques"],
                personality: "sociable"
            },
            "dahougou": {
                name: "DAHOUGOU Noham",
                password: "noham",
                notes: [15.25, 18.50, 3, 12, 8.75, 13, 5.75, 18, 14],
                comment: "Noham montre de belles capacit√©s en expression √©crite et en √©ducation sportive. La dict√©e et les math√©matiques n√©cessitent un travail r√©gulier suppl√©mentaire.",
                strengths: ["Expression √âcrite", "√âducation Sportive"],
                improvements: ["Dict√©e", "Math√©matiques"],
                personality: "energique"
            },
            "eda": {
                name: "EDA Queen",
                password: "queen",
                notes: [19, 18.25, 4, 13.75, 14.5, 12, 15.75, 18, 14],
                comment: "Queen poss√®de d'excellentes comp√©tences en lecture. Nous devons travailler ensemble sur la dict√©e pour am√©liorer son orthographe.",
                strengths: ["Lecture"],
                improvements: ["Dict√©e"],
                personality: "lecteur"
            },
            "houehou": {
                name: "HOUEHOU M√©ka",
                password: "m√©ka",
                notes: [18.75, 19.5, 9, 15, 14, 14.5, 17.25, 17, 13],
                comment: "M√©ka est un √©l√®ve tr√®s appliqu√© qui obtient d'excellents r√©sultats dans la plupart des mati√®res. F√©licitations pour ce beau travail!",
                strengths: ["Expression √âcrite", "Math√©matiques"],
                improvements: [],
                personality: "applique"
            },
            "padonou": {
                name: "PADONOU Faith",
                password: "faith",
                notes: [19, 15.75, 4, 19, 17.25, 15, 13.75, 18, 13],
                comment: "Faith excelle en lecture et en √©ducation sociale. Continuez √† l'encourager dans sa progression en expression √©crite.",
                strengths: ["Lecture", "√âducation Sociale"],
                improvements: ["Expression √âcrite"],
                personality: "equilibre"
            },
            "sovi": {
                name: "SOVI P√©niel",
                password: "p√©niel",
                notes: [12.5, 18.25, 8, 18.5, 16.5, 13, 16.25, 17, 14],
                comment: "P√©niel montre de tr√®s bonnes aptitudes en √©ducation sociale et scientifique. Un petit effort en lecture serait b√©n√©fique.",
                strengths: ["√âducation Sociale", "√âducation Scientifique"],
                improvements: ["Lecture"],
                personality: "scientifique"
            },
            "tossavi": {
                name: "TOSSAVI Naelle",
                password: "naelle",
                notes: [19, 16.75, 9, 18, 18, 15, 12.25, 17, 14],
                comment: "Naelle a obtenu d'excellents r√©sultats en lecture, √©ducation sociale et scientifique. Continuez sur cette belle lanc√©e!",
                strengths: ["Lecture", "√âducation Sociale", "√âducation Scientifique"],
                improvements: [],
                personality: "excellence"
            }
        };

        this.subjects = [
            "Lecture", "Expression √âcrite", "Dict√©e", "√âducation Sociale", 
            "√âducation Scientifique", "Dessin", "Math√©matiques", 
            "√âducation Sportive", "√âducation Artistique"
        ];

        this.analytics = {
            totalLogins: 0,
            successfulLogins: 0,
            printedCertificates: 0,
            studentViews: {},
            sessionStart: new Date()
        };

        this.init();
    }

    // ===== INITIALISATION INTELLIGENTE =====
    init() {
        console.log('üéì Syst√®me Smart School initialis√©');
        this.setupEventListeners();
        this.setupSmartAnimations();
        this.setupVoiceAssistant();
        this.setupAnalytics();
        this.setupAIRecommendations();
        this.setupRealTimeUpdates();
        this.createWelcomeEffect();
    }

    // ===== GESTIONNAIRE D'√âV√âNEMENTS AVANC√â =====
    setupEventListeners() {
        const submitBtn = document.getElementById('submitBtn');
        const passwordInput = document.getElementById('passwordInput');
        const studentSelect = document.getElementById('studentSelect');

        // √âv√©nement de soumission intelligent
        submitBtn.addEventListener('click', () => this.handleLogin());

        // Auto-compl√©tion du mot de passe
        studentSelect.addEventListener('change', (e) => {
            if (e.target.value) {
                passwordInput.placeholder = `Pr√©nom de ${this.studentsData[e.target.value].name.split(' ')[1]}`;
                passwordInput.focus();
            }
        });

        // Soumission avec Entr√©e
        passwordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.handleLogin();
        });

        // Reconnaissance vocale
        this.setupVoiceRecognition();

        // Gestes tactiles
        this.setupTouchGestures();
    }

    // ===== CONNEXION INTELLIGENTE =====
    async handleLogin() {
        const selectedStudent = document.getElementById('studentSelect').value;
        const enteredPassword = document.getElementById('passwordInput').value.trim().toLowerCase();

        if (!selectedStudent) {
            this.showSmartNotification('Veuillez s√©lectionner un √©l√®ve', 'warning');
            return;
        }

        if (!enteredPassword) {
            this.showSmartNotification('Veuillez entrer le mot de passe', 'warning');
            return;
        }

        this.analytics.totalLogins++;

        const student = this.studentsData[selectedStudent];
        
        if (enteredPassword === student.password) {
            this.analytics.successfulLogins++;
            this.analytics.studentViews[selectedStudent] = (this.analytics.studentViews[selectedStudent] || 0) + 1;
            
            await this.performLoginAnimation();
            this.displaySmartResults(student);
            this.createCelebrationEffect();
            this.speak(`Bienvenue ${student.name.split(' ')[1]} ! Voici vos r√©sultats.`);
            
            // Envoyer une notification push si support√©
            this.sendPushNotification(`R√©sultats consult√©s pour ${student.name}`);
        } else {
            this.handleFailedLogin(selectedStudent, enteredPassword);
        }
    }

    // ===== ANIMATION DE CONNEXION =====
    async performLoginAnimation() {
        const submitBtn = document.getElementById('submitBtn');
        const originalText = submitBtn.innerHTML;
        
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Connexion...';
        submitBtn.disabled = true;

        // Simulation de traitement
        await new Promise(resolve => setTimeout(resolve, 1500));

        submitBtn.innerHTML = '<i class="fas fa-check"></i> Connect√© !';
        
        await new Promise(resolve => setTimeout(resolve, 500));
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }

    // ===== AFFICHAGE DES R√âSULTATS INTELLIGENTS =====
    displaySmartResults(student) {
        const stats = this.calculateAdvancedStats(student);
        const resultsContainer = document.getElementById('resultsContainer');
        
        resultsContainer.style.display = 'block';
        resultsContainer.innerHTML = this.generateSmartResultsHTML(student, stats);
        
        this.animateResultsAppearance();
        this.setupResultsInteractions(student, stats);
    }

    // ===== CALCULS AVANC√âS =====
    calculateAdvancedStats(student) {
        const notes = student.notes;
        const average = notes.reduce((a, b) => a + b, 0) / notes.length;
        
        // Trouver la mati√®re la plus forte
        let bestSubjectIndex = 0;
        let bestNote = notes[0];
        let worstSubjectIndex = 0;
        let worstNote = notes[0];
        
        for (let i = 1; i < notes.length; i++) {
            if (notes[i] > bestNote) {
                bestNote = notes[i];
                bestSubjectIndex = i;
            }
            if (notes[i] < worstNote) {
                worstNote = notes[i];
                worstSubjectIndex = i;
            }
        }

        // Analyse de progression (simul√©e)
        const progress = this.calculateProgress(student);
        const ranking = this.calculateClassRanking(student);
        const predictions = this.generatePredictions(student);

        return {
            average: average.toFixed(2),
            bestSubject: this.subjects[bestSubjectIndex],
            bestNote: bestNote,
            worstSubject: this.subjects[worstSubjectIndex],
            worstNote: worstNote,
            progress: progress,
            ranking: ranking,
            predictions: predictions,
            performance: this.analyzePerformance(student)
        };
    }

    // ===== G√âN√âRATION HTML INTELLIGENTE =====
    generateSmartResultsHTML(student, stats) {
        return `
            <div class="smart-results">
                <h3 class="student-name">${student.name}</h3>
                
                <!-- Cartes de statistiques avanc√©es -->
                <div class="smart-stats-container">
                    ${this.generateStatsCards(stats)}
                </div>

                <!-- Analyse de performance -->
                <div class="performance-analysis">
                    <h4><i class="fas fa-chart-line"></i> Analyse de Performance</h4>
                    <div class="analysis-grid">
                        ${this.generatePerformanceAnalysis(stats.performance)}
                    </div>
                </div>

                <!-- Tableau des notes avec visualisation -->
                <div class="table-container">
                    <table class="grades-table">
                        <thead>
                            <tr>
                                ${this.subjects.map(subject => `
                                    <th data-subject="${subject}">
                                        <span>${subject}</span>
                                        <i class="fas fa-info-circle" onclick="schoolSystem.showSubjectTips('${subject}')"></i>
                                    </th>
                                `).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                ${student.notes.map((note, index) => `
                                    <td class="note-cell ${note < 5 ? 'low-note' : ''} ${note >= 18 ? 'high-note' : ''}" 
                                        data-note="${note}"
                                        data-subject="${this.subjects[index]}">
                                        ${note}
                                        <div class="note-bar" style="transform: scaleX(${note/20})"></div>
                                        <div class="note-sparkle"></div>
                                    </td>
                                `).join('')}
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Recommandations IA -->
                <div class="ai-recommendations">
                    <h4><i class="fas fa-robot"></i> Recommandations Personnalis√©es</h4>
                    ${this.generateAIRecommendations(student, stats)}
                </div>

                <!-- Commentaire enseignant avec √©motions -->
                <div class="teacher-comment enhanced">
                    <div class="comment-header">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <span class="comment-title">Commentaire de l'enseignant</span>
                        <span class="sentiment-indicator ${this.analyzeSentiment(student.comment)}"></span>
                    </div>
                    <p>${student.comment}</p>
                    <div class="comment-meta">
                        <span class="date">${new Date().toLocaleDateString('fr-FR')}</span>
                        <span class="teacher">C. J. S. Stein</span>
                    </div>
                </div>

                <!-- Actions intelligentes -->
                <div class="smart-actions">
                    <button class="btn btn-accent" id="certificateBtn">
                        <i class="fas fa-certificate"></i> Certificat de R√©ussite
                    </button>
                    <button class="btn" id="printBulletinBtn">
                        <i class="fas fa-print"></i> Imprimer le Bulletin
                    </button>
                    <button class="btn btn-info" id="shareResultsBtn">
                        <i class="fas fa-share-alt"></i> Partager
                    </button>
                    <button class="btn btn-warning" id="studyPlanBtn">
                        <i class="fas fa-calendar-check"></i> Plan d'√âtude
                    </button>
                </div>
            </div>
        `;
    }

    // ===== G√âN√âRATION DES CARTES DE STATISTIQUES =====
    generateStatsCards(stats) {
        const cards = [
            {
                icon: 'fas fa-chart-bar',
                title: 'Moyenne G√©n√©rale',
                value: `${stats.average}/20`,
                trend: stats.progress > 0 ? 'up' : stats.progress < 0 ? 'down' : 'stable',
                color: 'primary'
            },
            {
                icon: 'fas fa-trophy',
                title: 'Mati√®re Excellente',
                value: stats.bestSubject,
                subtitle: `${stats.bestNote}/20`,
                color: 'gold'
            },
            {
                icon: 'fas fa-rocket',
                title: 'Progression',
                value: `${stats.progress > 0 ? '+' : ''}${stats.progress}%`,
                trend: stats.progress > 0 ? 'up' : 'down',
                color: 'accent'
            },
            {
                icon: 'fas fa-chess-king',
                title: 'Classement',
                value: `${stats.ranking.position}√®me`,
                subtitle: `sur ${stats.ranking.total}`,
                color: 'secondary'
            }
        ];

        return cards.map(card => `
            <div class="stat-card ${card.color}">
                <div class="stat-icon">
                    <i class="${card.icon}"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-title">${card.title}</div>
                    <div class="stat-value">${card.value}</div>
                    ${card.subtitle ? `<div class="stat-subtitle">${card.subtitle}</div>` : ''}
                    ${card.trend ? `<div class="stat-trend ${card.trend}">
                        <i class="fas fa-arrow-${card.trend}"></i>
                    </div>` : ''}
                </div>
            </div>
        `).join('');
    }

    // ===== SYST√àME DE RECOMMANDATIONS IA =====
    generateAIRecommendations(student, stats) {
        const recommendations = [];
        
        // Recommandations bas√©es sur les notes
        if (stats.worstNote < 10) {
            recommendations.push({
                type: 'warning',
                icon: 'fas fa-exclamation-triangle',
                text: `Priorit√©: Renforcer ${stats.worstSubject} avec des exercices quotidiens`
            });
        }

        // Recommandations bas√©es sur les forces
        if (stats.bestNote >= 18) {
            recommendations.push({
                type: 'success',
                icon: 'fas fa-star',
                text: `Excellence en ${stats.bestSubject} - Poursuivre cet effort !`
            });
        }

        // Recommandations personnalis√©es selon la personnalit√©
        const personalityRecommendations = {
            curieux: "Encouragez la lecture de livres vari√©s pour nourrir sa curiosit√© naturelle.",
            sportif: "Associez l'apprentissage √† des activit√©s physiques pour mieux retenir.",
            creatif: "Utilisez des m√©thodes d'apprentissage visuelles et cr√©atives.",
            sociable: "Organisez des sessions d'√©tude en groupe pour progresser ensemble.",
            energique: "Divisez les sessions de travail en p√©riodes courtes et dynamiques.",
            lecteur: "Profitez de son amour de la lecture pour enrichir son vocabulaire.",
            applique: "Maintenez ce rythme de travail r√©gulier qui porte ses fruits.",
            equilibre: "Continuez √† d√©velopper toutes les comp√©tences de mani√®re harmonieuse.",
            scientifique: "Exp√©rimentez avec des projets pratiques pour renforcer l'apprentissage.",
            excellence: "Proposez des d√©fis suppl√©mentaires pour continuer √† progresser."
        };

        recommendations.push({
            type: 'info',
            icon: 'fas fa-user-graduate',
            text: personalityRecommendations[student.personality] || "Continuez les efforts dans toutes les mati√®res."
        });

        return recommendations.map(rec => `
            <div class="recommendation ${rec.type}">
                <i class="${rec.icon}"></i>
                <span>${rec.text}</span>
            </div>
        `).join('');
    }

    // ===== ANIMATIONS INTELLIGENTES =====
    animateResultsAppearance() {
        const elements = document.querySelectorAll('.stat-card, .note-cell, .recommendation');
        
        elements.forEach((element, index) => {
            element.style.opacity = '0';
            element.style.transform = 'translateY(30px)';
            
            setTimeout(() => {
                element.style.transition = 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                element.style.opacity = '1';
                element.style.transform = 'translateY(0)';
            }, index * 100);
        });

        // Animation des barres de notes
        setTimeout(() => {
            document.querySelectorAll('.note-bar').forEach(bar => {
                bar.style.transform = 'scaleX(1)';
            });
        }, 500);
    }

    // ===== ASSISTANT VOCAL =====
    setupVoiceAssistant() {
        if ('speechSynthesis' in window) {
            this.speechSynthesis = window.speechSynthesis;
            
            // Cr√©er un bouton d'activation vocale
            this.createVoiceControlButton();
        }
    }

    speak(text) {
        if (this.speechSynthesis) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'fr-FR';
            utterance.rate = 0.9;
            utterance.pitch = 1;
            this.speechSynthesis.speak(utterance);
        }
    }

    // ===== RECONNAISSANCE VOCALE =====
    setupVoiceRecognition() {
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.continuous = false;
            recognition.lang = 'fr-FR';
            recognition.interimResults = false;

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase();
                this.processVoiceCommand(transcript);
            };

            recognition.onerror = (event) => {
                console.log('Erreur de reconnaissance vocale:', event.error);
            };

            this.voiceRecognition = recognition;
        }
    }

    processVoiceCommand(command) {
        const passwordInput = document.getElementById('passwordInput');
        
        if (command.includes('mot de passe')) {
            const password = command.replace('mot de passe', '').trim();
            passwordInput.value = password;
            this.showSmartNotification(`Mot de passe "${password}" saisi vocalement`, 'info');
        }
        
        if (command.includes('connecter') || command.includes('valider')) {
            this.handleLogin();
        }
    }

    // ===== GESTES TACTILES =====
    setupTouchGestures() {
        let startX, startY;
        
        document.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', (e) => {
            if (!startX || !startY) return;
            
            const endX = e.changedTouches[0].clientX;
            const endY = e.changedTouches[0].clientY;
            
            const diffX = startX - endX;
            const diffY = startY - endY;
            
            // Swipe gauche pour effacer
            if (Math.abs(diffX) > 50 && Math.abs(diffY) < 50) {
                if (diffX > 0) {
                    document.getElementById('passwordInput').value = '';
                    this.showSmartNotification('Champ effac√©', 'info');
                }
            }
            
            // Swipe vers le haut pour remonter
            if (Math.abs(diffY) > 50 && Math.abs(diffX) < 50) {
                if (diffY > 0) {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }
        });
    }

    // ===== SYST√àME DE NOTIFICATIONS INTELLIGENT =====
    showSmartNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `smart-notification ${type}`;
        notification.innerHTML = `
            <i class="fas fa-${this.getNotificationIcon(type)}"></i>
            <span>${message}</span>
            <button onclick="this.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        `;
        
        document.body.appendChild(notification);
        
        // Animation d'entr√©e
        setTimeout(() => notification.classList.add('show'), 100);
        
        // Suppression automatique
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
        }, 4000);
    }

    getNotificationIcon(type) {
        const icons = {
            info: 'info-circle',
            success: 'check-circle',
            warning: 'exclamation-triangle',
            error: 'times-circle'
        };
        return icons[type] || 'info-circle';
    }

    // ===== EFFETS VISUELS AVANC√âS =====
    createCelebrationEffect() {
        // Confettis avanc√©s
        this.createAdvancedConfetti();
        
        // Effet de particules
        this.createParticleEffect();
        
        // Animation de succ√®s
        this.createSuccessAnimation();
    }

    createAdvancedConfetti() {
        const colors = ['#4A6FA5', '#FF9E6D', '#6BCF7F', '#FFD700', '#EF476F'];
        
        for (let i = 0; i < 150; i++) {
            setTimeout(() => {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.cssText = `
                    left: ${Math.random() * 100}vw;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    width: ${Math.random() * 12 + 8}px;
                    height: ${Math.random() * 12 + 8}px;
                    animation-delay: ${Math.random() * 2}s;
                    transform: rotate(${Math.random() * 360}deg);
                `;
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 5000);
            }, i * 20);
        }
    }

    createParticleEffect() {
        const container = document.querySelector('.results-container');
        if (!container) return;
        
        for (let i = 0; i < 30; i++) {
            const particle = document.createElement('div');
            particle.className = 'success-particle';
            particle.style.cssText = `
                left: ${Math.random() * 100}%;
                top: ${Math.random() * 100}%;
                animation-delay: ${Math.random() * 1}s;
            `;
            container.appendChild(particle);
            
            setTimeout(() => particle.remove(), 2000);
        }
    }

    // ===== GESTION DES ERREURS INTELLIGENTE =====
    handleFailedLogin(studentId, enteredPassword) {
        const student = this.studentsData[studentId];
        const correctPassword = student.password;
        
        // Analyse de l'erreur
        let hint = '';
        if (enteredPassword.length < correctPassword.length) {
            hint = 'Le mot de passe semble trop court';
        } else if (enteredPassword.length > correctPassword.length) {
            hint = 'Le mot de passe semble trop long';
        } else {
            hint = 'V√©rifiez les accents et la casse';
        }
        
        this.showSmartNotification(`Mot de passe incorrect. ${hint}`, 'error');
        
        // Effet visuel d'erreur
        this.createErrorEffect();
        
        // Vibration si support√©
        if (navigator.vibrate) {
            navigator.vibrate([100, 50, 100]);
        }
    }

    createErrorEffect() {
        const passwordInput = document.getElementById('passwordInput');
        passwordInput.style.animation = 'shake 0.5s ease-in-out';
        
        setTimeout(() => {
            passwordInput.style.animation = '';
        }, 500);
    }

    // ===== M√âTHODES D'ANALYSE AVANC√âE =====
    calculateProgress(student) {
        // Simulation de donn√©es de progression
        return Math.floor(Math.random() * 21) - 10; // -10% √† +10%
    }

    calculateClassRanking(student) {
        // Simulation de classement
        const totalStudents = Object.keys(this.studentsData).length;
        const average = student.notes.reduce((a, b) => a + b, 0) / student.notes.length;
        
        // Simulation bas√©e sur la moyenne
        let position = Math.max(1, Math.min(totalStudents, Math.floor((20 - average) * 2)));
        
        return {
            position: position,
            total: totalStudents
        };
    }

    analyzePerformance(student) {
        const notes = student.notes;
        const average = notes.reduce((a, b) => a + b, 0) / notes.length;
        
        return {
            level: average >= 16 ? 'Excellent' : average >= 12 ? 'Bon' : average >= 8 ? 'Moyen' : '√Ä renforcer',
            consistency: this.calculateConsistency(notes),
            trend: this.analyzeTrend(notes),
            strengths: student.strengths,
            improvements: student.improvements
        };
    }

    calculateConsistency(notes) {
        const variance = notes.reduce((acc, note) => acc + Math.pow(note - 10, 2), 0) / notes.length;
        return variance < 10 ? '√âquilibr√©' : variance < 20 ? 'Variable' : 'Irregular';
    }

    analyzeTrend(notes) {
        // Simulation d'analyse de tendance
        return Math.random() > 0.5 ? 'Am√©lioration' : 'Stable';
    }

    analyzeSentiment(comment) {
        const positiveWords = ['excellent', 'excellente', 'bon', 'belle', 'f√©licitations', 'talent', 'appliqu√©', 'progression'];
        const negativeWords = ['effort', 'n√©cessaire', 'renforcer', 'travail', 'soutenu'];
        
        const positiveCount = positiveWords.filter(word => comment.toLowerCase().includes(word)).length;
        const negativeCount = negativeWords.filter(word => comment.toLowerCase().includes(word)).length;
        
        return positiveCount > negativeCount ? 'positive' : positiveCount < negativeCount ? 'negative' : 'neutral';
    }

    generatePredictions(student) {
        // Simulation de pr√©dictions IA
        return {
            nextTerm: `Potentiel d'atteindre ${(parseFloat(this.calculateAdvancedStats(student).average) + 1).toFixed(1)}/20`,
            focusArea: student.improvements[0] || 'Maintenir les excellents r√©sultats',
            recommendation: 'Continuer le travail r√©gulier'
        };
    }

    // ===== SYST√àME D'ANALYTIQUES =====
    setupAnalytics() {
        // Envoi p√©riodique des donn√©es (simul√©)
        setInterval(() => {
            this.sendAnalyticsData();
        }, 30000); // Toutes les 30 secondes
    }

    sendAnalyticsData() {
        const data = {
            ...this.analytics,
            sessionDuration: new Date() - this.analytics.sessionStart,
            userAgent: navigator.userAgent,
            screenResolution: `${screen.width}x${screen.height}`
        };
        
        console.log('üìä Donn√©es analytiques:', data);
        // Ici, vous enverriez les donn√©es √† votre serveur
    }

    // ===== M√âTHODES UTILITAIRES =====
    createWelcomeEffect() {
        setTimeout(() => {
            this.showSmartNotification('Bienvenue sur le syst√®me de r√©sultats des Bulles de Joie !', 'info');
        }, 1000);
    }

    createVoiceControlButton() {
        const voiceBtn = document.createElement('button');
        voiceBtn.className = 'voice-control-btn';
        voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
        voiceBtn.title = 'Activer la reconnaissance vocale';
        
        voiceBtn.addEventListener('click', () => {
            if (this.voiceRecognition) {
                this.voiceRecognition.start();
                this.showSmartNotification('√âcoute en cours... Parlez maintenant', 'info');
            }
        });
        
        document.querySelector('.password-form').appendChild(voiceBtn);
    }

    sendPushNotification(message) {
        if ('Notification' in window && Notification.permission === 'granted') {
            new Notification('Les Bulles de Joie', {
                body: message,
                icon: '/favicon.ico'
            });
        }
    }

    // ===== M√âTHODES PUBLIQUES =====
    showSubjectTips(subject) {
        const tips = {
            'Lecture': 'Pratiquez 15 minutes de lecture quotidienne',
            'Expression √âcrite': 'Tenez un journal personnel pour am√©liorer votre expression',
            'Dict√©e': '√âcoutez et √©crivez des histoires courtes chaque jour',
            'Math√©matiques': 'R√©solvez un probl√®me math√©matique par jour',
            '√âducation Scientifique': 'Faites des exp√©riences simples √† la maison'
        };
        
        this.showSmartNotification(`üí° ${tips[subject] || 'Continuez √† pratiquer r√©guli√®rement'}`, 'info');
    }
}

// ===== INITIALISATION DU SYST√àME =====
let schoolSystem;

document.addEventListener('DOMContentLoaded', function() {
    schoolSystem = new SmartSchoolSystem();
    
    // Ajout des styles CSS dynamiques
    const dynamicStyles = `
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .smart-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-left: 4px solid #4A6FA5;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
        }
        
        .smart-notification.show {
            transform: translateX(0);
        }
        
        .smart-notification.success { border-left-color: #6BCF7F; }
        .smart-notification.warning { border-left-color: #FF9E6D; }
        .smart-notification.error { border-left-color: #EF476F; }
        
        .voice-control-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: #4A6FA5;
            cursor: pointer;
            padding: 5px;
        }
        
        .success-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #6BCF7F;
            border-radius: 50%;
            animation: particlePop 2s ease-out forwards;
            pointer-events: none;
        }
        
        @keyframes particlePop {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(1) translateY(-50px);
                opacity: 0;
            }
        }
        
        .sentiment-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 10px;
        }
        
        .sentiment-indicator.positive { background: #6BCF7F; }
        .sentiment-indicator.negative { background: #EF476F; }
        .sentiment-indicator.neutral { background: #FF9E6D; }
    `;
    
    const styleSheet = document.createElement('style');
    styleSheet.textContent = dynamicStyles;
    document.head.appendChild(styleSheet);
});

// ===== EXPOSITION GLOBALE POUR LES APPELS HTML =====
window.schoolSystem = schoolSystem;